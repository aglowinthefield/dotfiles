{{- if or (eq .chezmoi.os "darwin") (eq .chezmoi.os "linux") -}}
#!/bin/sh
set -eu

{{- if eq .chezmoi.os "darwin" }}

# Install Homebrew if not installed
if ! command -v brew >/dev/null 2>&1; then
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
fi

{{- else if eq .chezmoi.os "linux" }}

  {{- if eq .chezmoi.osRelease.id "arch" }}

# Install yay (Arch) if not installed
if ! command -v yay >/dev/null 2>&1; then
  echo "yay not found, installing via pacman + AURâ€¦"

  # Ensure git + base-devel installed
  sudo pacman -S --needed --noconfirm git base-devel

  # Clone yay if needed
  if [ ! -d "$HOME/yay" ]; then
    git clone https://aur.archlinux.org/yay.git "$HOME/yay"
  fi

  # Build & install yay
  cd "$HOME/yay"
  makepkg -si --noconfirm
else
  echo "yay already installed"
fi

  {{- end }}   # end arch guard
{{- end }}     # end linux if

{{- end -}}    # end top-level guard

